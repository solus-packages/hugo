From d55747ebce26648a1c91ec99d9ec087d9e4e2566 Mon Sep 17 00:00:00 2001
From: Joshua Strobl <joshua@stroblindustries.com>
Date: Thu, 18 Jan 2018 17:12:43 +0200
Subject: [PATCH 1/1] Revert "Support offline builds"

This reverts commit d5803da1befba5446d1b2c1ad16f6467dc7b3991.
---
 appveyor.yml   | 2 +-
 magefile.go    | 5 +++++
 snapcraft.yaml | 3 ++-
 3 files changed, 8 insertions(+), 2 deletions(-)

diff --git a/appveyor.yml b/appveyor.yml
index 0ed9e959..af1bb3ad 100644
--- a/appveyor.yml
+++ b/appveyor.yml
@@ -12,7 +12,7 @@ install:
   - go get github.com/magefile/mage
 
 build_script:
-  - mage vendor hugoRace
+  - mage hugoRace
   - mage -v check
   - hugo -s docs/
   - hugo --renderToMemory -s docs/
diff --git a/magefile.go b/magefile.go
index d483585a..21e7a3ca 100644
--- a/magefile.go
+++ b/magefile.go
@@ -45,16 +45,19 @@ func Vendor() error {
 
 // Build hugo binary
 func Hugo() error {
+	mg.Deps(Vendor)
 	return sh.RunWith(flagEnv(), goexe, "build", "-ldflags", ldflags, packageName)
 }
 
 // Build hugo binary with race detector enabled
 func HugoRace() error {
+	mg.Deps(Vendor)
 	return sh.RunWith(flagEnv(), goexe, "build", "-race", "-ldflags", ldflags, packageName)
 }
 
 // Install hugo binary
 func Install() error {
+	mg.Deps(Vendor)
 	return sh.RunWith(flagEnv(), goexe, "install", "-ldflags", ldflags, packageName)
 }
 
@@ -112,11 +115,13 @@ func Test386() error {
 
 // Run tests
 func Test() error {
+	mg.Deps(getDep)
 	return sh.Run(goexe, "test", "./...")
 }
 
 // Run tests with race detector
 func TestRace() error {
+	mg.Deps(getDep)
 	return sh.Run(goexe, "test", "-race", "./...")
 }
 
diff --git a/snapcraft.yaml b/snapcraft.yaml
index a8f861a5..1be4bcfa 100644
--- a/snapcraft.yaml
+++ b/snapcraft.yaml
@@ -29,7 +29,8 @@ parts:
       export PATH=$GOPATH/bin:$PATH
       cd $GOPATH/src/github.com/gohugoio/hugo
       go get github.com/magefile/mage
-      mage vendor test
+      mage vendor
+      mage test
       rm -f $GOPATH/bin/dep
       rm -f $GOPATH/bin/mage
     install: |
-- 
2.15.1

